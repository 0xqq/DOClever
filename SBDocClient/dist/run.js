webpackJsonp([0],{122:function(e,t,a){(function(e,t,r){var n=a(5),o=a(31),s=a(29),i=a(28),u=a(30),f=a(19),c=a(40);e.get("interfaceId")&&e.get("groupId")||!(location.hash.length<=1)||(alert("请从项目详情页进来!"),location.href="../projectinfo/projectinfo.html");new t({el:"#app",data:{session:r.clone(e.raw()),runPending:!1},components:{mainnav:n,runquery:o,runheader:s,runbody:i,runparam:u,encrypt:f},store:c,computed:{interface:function(){return c.state.interface},baseUrl:{get:function(){return c.state.baseUrl},set:function(e){c.commit("setBaseUrl",e)}},paramTab:function(){return"Param ("+c.getters.paramCount+")"},queryTab:function(){return"Query ("+c.getters.queryCount+")"},headerTab:function(){return"Header ("+c.getters.headerCount+")"},bodyTab:function(){return"Body ("+(0==c.state.bodyInfo.type?c.getters.bodyCount:"Raw")+")"},param:function(){return c.state.param},querySave:function(){return c.getters.querySave},headerSave:function(){return c.getters.headerSave},bodySave:function(){return c.getters.bodySave},drawMix:function(){return c.state.drawMix},bodyInfo:function(){return c.state.bodyInfo},queryRawShow:function(){return c.state.queryRawShow},headerRawShow:function(){return c.state.headerRawShow},bodyRawShow:function(){return c.state.bodyRawShow},status:function(){return c.state.status},second:function(){return c.state.second},type:function(){return c.state.type},draw:function(){return c.state.draw},drawMix:function(){return c.state.drawMix},imgUrl:function(){return c.state.imgUrl},rawData:function(){return c.state.rawData},resHeader:function(){return c.state.resHeader},queryRawStr:{get:function(){return c.state.queryRawStr},set:function(e){c.commit("setQueryRawStr",e)}},headerRawStr:{get:function(){return c.state.headerRawStr},set:function(e){c.commit("setHeaderRawStr",e)}},bodyRawStr:{get:function(){return c.state.bodyRawStr},set:function(e){c.commit("setBodyRawStr",e)}}},methods:{run:function(){var e=this;this.runPending=!0,c.dispatch("run").then(function(t){e.runPending=!1,200==t.code?r.notify("运行成功",1):r.notify(t.msg,0)})},save:function(){c.dispatch("save").then(function(e){e&&0==e.code&&r.notify(e.msg,0)})},toggleQuery:function(){c.commit("toggleQuery")},toggleHeader:function(){c.commit("toggleHeader")},toggleBody:function(){c.commit("toggleBody")},changeUrl:function(e){c.commit("changeUrl",e)},querySearch:function(e,t){var a=this;setTimeout(function(){var r=a.interface.baseUrl.map(function(e){return{value:e}});c.state.hash||r.push({value:"MockServer"}),e&&(r=r.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1})),t(r)},100)},showAutoComplete:function(e){this.baseUrl="",setTimeout(function(){e.target.nextSibling.focus()},100)}},created:function(){c.dispatch("init").then(function(e){r.stopLoading(),200!=e.code&&r.notify(e.msg,0)})}});r.ready(function(){r.startLoading()})}).call(t,a(3),a(0),a(2))},40:function(e,t,a){(function(t,r,n,o,s,i){var u=a(10);e.exports=new t.Store({state:{interface:{},baseUrl:"",query:[{name:"",must:0,remark:"",value:"",selValue:"",enable:1}],header:[{name:"",value:"",remark:""}],body:[{name:"",type:0,must:0,remark:"",value:"",selValue:"",enable:1}],param:[],bodyInfo:{type:0,rawType:0,rawTextRemark:"",rawFileRemark:"",rawText:""},fileResult:"",resHeader:[],status:"",second:"",draw:[],drawMix:[],type:"object",imgUrl:"",hash:"",resultData:"",queryRawShow:0,headerRawShow:0,bodyRawShow:0,queryRawStr:"",headerRawStr:"",bodyRawStr:"",rawData:"",encryptType:""},getters:{querySave:function(e,t){return e.query.filter(function(e){return!(!e.name||!e.enable)})},headerSave:function(e,t){return e.header.filter(function(e){return!!e.name})},bodySave:function(e,t){return e.body.filter(function(e){return!(!e.name||!e.enable)})},queryCount:function(e,t){return t.querySave.length},headerCount:function(e,t){return t.headerSave.length},bodyCount:function(e,t){return t.bodySave.length},paramCount:function(e,t){return e.param.length}},mutations:{initData:function(e,t){if(e.interface=t,e.baseUrl=t.baseUrl.length>0?t.baseUrl[0]:"",e.interface.queryParam.length>0){for(var a=0;a<e.interface.queryParam.length;a++)r.set(e.interface.queryParam[a],"enable",1),r.set(e.interface.queryParam[a],"selValue",""),e.interface.queryParam[a].value&&e.interface.queryParam[a].value.length>0?e.interface.queryParam[a].selValue=e.interface.queryParam[a].value[0]:e.interface.queryParam[a].selValue="";e.query=e.interface.queryParam}if(e.interface.bodyParam.length>0){for(var a=0;a<e.interface.bodyParam.length;a++)r.set(e.interface.bodyParam[a],"enable",1),r.set(e.interface.bodyParam[a],"selValue",""),e.interface.bodyParam[a].value&&e.interface.bodyParam[a].value.length>0?e.interface.bodyParam[a].selValue=e.interface.bodyParam[a].value[0]:e.interface.bodyParam[a].selValue="";e.body=e.interface.bodyParam}if(e.interface.header.length>0&&(e.header=e.interface.header),e.interface.restParam.length>0){for(var a=0;a<e.interface.restParam.length;a++)r.set(e.interface.restParam[a],"selValue",""),e.interface.restParam[a].value&&e.interface.restParam[a].value.length>0?e.interface.restParam[a].selValue=e.interface.restParam[a].value[0]:e.interface.restParam[a].selValue="";e.param=e.interface.restParam}e.interface.bodyInfo&&(e.bodyInfo=e.interface.bodyInfo,void 0===e.bodyInfo.rawText&&r.set(e.bodyInfo,"rawText",""),void 0===e.bodyInfo.rawTextRemark&&r.set(e.bodyInfo,"rawTextRemark",""),void 0===e.bodyInfo.rawFileRemark&&r.set(e.bodyInfo,"rawFileRemark",""))},setFileResult:function(e,t){e.fileResult=t},toggleQuery:function(e){if(e.queryRawShow){e.queryRawShow=0;for(var t=decodeURI(n.trim(e.queryRawStr)),a=[],r=t.split("&"),s=0;s<r.length;s++){var i=r[s].split("=");if(i.length>0){var u=o.findValue(e.query,i[0]);a.push({name:i[0],must:u?u.must:1,remark:u?u.remark:"",selValue:i[1]?i[1]:"",enable:u?u.enable:1,value:u?u.value:null,encrypt:u&&u.encrypt?u.encrypt:{type:"",salt:"",key:0}})}}e.query=a}else{e.queryRawShow=1;for(var t="",a=e.query,s=0;s<a.length;s++)a[s].name&&(t+=a[s].name+"="+a[s].selValue+(s!=a.length-1?"&":""));e.queryRawStr=t}},toggleHeader:function(e){if(e.headerRawShow){e.headerRawShow=0;for(var t=n.trim(e.headerRawStr).split("\n"),a=[],r=0;r<t.length;r++){var o=n.trim(t[r]),s=o.indexOf(":"),i="",u="";if(s==-1?i=o:(i=n.trim(o.substr(0,s)),u=n.trim(o.substr(s+1))),i){var f=n.findValue(e.header,i);a.push({name:i,value:u,remark:f?f.remark:"",encrypt:f&&f.encrypt?f.encrypt:{type:"",salt:"",key:0}})}}0==a.length&&a.push({name:"",value:"",remark:""}),e.header=a}else{e.headerRawShow=1;for(var c="",t=e.header,r=0;r<t.length;r++)t[r].name&&(c+=t[r].name+":"+(t[r].value?t[r].value:"")+(r!=t.length-1?"\n":""));e.headerRawStr=c}},toggleBody:function(e){if(e.bodyRawShow){e.bodyRawShow=0;for(var t=decodeURI(n.trim(e.bodyRawStr)),a=[],r=t.split("&"),o=0;o<r.length;o++){var s=r[o].split("=");if(s.length>0){var i=n.findValue(e.body,s[0]),u=s[1]?s[1]:"";i&&1!=i.type&&(i.selValue=u),a.push({name:s[0],type:i?i.type:"[FILE]"==u?1:0,must:i?i.must:1,remark:i?i.remark:"",selValue:u,enable:i?i.enable:1,value:i?i.value:null,encrypt:i&&i.encrypt?i.encrypt:{type:"",salt:"",key:0}})}}e.body=a}else{e.bodyRawShow=1;for(var t="",a=e.body,o=0;o<a.length;o++)a[o].name&&(t+=a[o].name+"="+(1==a[o].type?"[FILE]":a[o].selValue)+(o!=a.length-1?"&":""));e.bodyRawStr=t}},changeUrl:function(e,t){if(t){var a=[],r=t.match(/\{([^\s]+?)\}/g);if(r)for(var n=0;n<r.length;n++){for(var o=r[n].substr(1,r[n].length-2),s=!1,i=0;i<e.param.length;i++)if(o==e.param[i].name){s=!0,a.push(e.param[i]);break}s||a.push({name:o,remark:"",value:[]})}e.param=a}},setBaseUrl:function(e,t){e.baseUrl=t},setQueryRawStr:function(e,t){e.queryRawStr=t},setHeaderRawStr:function(e,t){e.headerRawStr=t},setBodyRawStr:function(e,t){e.bodyRawStr=t}},actions:{run:function(e){var t=e.state.interface.method,a=n.trim(e.state.baseUrl),r=n.trim(e.state.interface.url);if(!t||!a||!r)return new Promise(function(e,t){var a={};a.code=0,a.msg="方法，url和路由地址不能为空!",e(a)});var f=!1;if("MockServer"!=a){var c,l=a.indexOf("://");if((c=l==-1?a.indexOf("/"):a.indexOf("/",l+3))>-1){var d=a.substring(0,c),y=a.substr(c);"/"==y[y.length-1]&&"/"==r[0]?y=y.substr(0,y.length-1):"/"!=y[y.length-1]&&"/"!=r[0]&&y.indexOf("?")==-1&&y.indexOf("#")==-1&&(y+="/"),a=d,r=y+r}else"/"!=r[0]&&(r="/"+r)}else f=!0,a=u.baseUrl,r="/mock/"+s.get("projectId")+("/"!=r[0]?"/"+r:r);e.state.param.forEach(function(e){e.name&&(r=r.replace("{"+e.name+"}",e.selValue))});var m={};e.getters.querySave.forEach(function(e){if(e.encrypt&&e.encrypt.type){var t=o.encrypt(e.encrypt.type,e.selValue,e.encrypt.salt),a=e.name;e.encrypt.key&&(a=o.encrypt(e.encrypt.type,a,e.encrypt.salt)),m[a]=t}else m[e.name]=e.selValue}),m=n.param(m),m.length>0&&(r=r+"?"+m);var p={},h=["host","connection","origin","referer","user-agent"],w={};e.getters.headerSave.forEach(function(e){if(e.encrypt&&e.encrypt.type){var t=o.encrypt(e.encrypt.type,e.value,e.encrypt.salt),a=e.name;n.inArr(a,h)?w[a]=t:p[a]=t}else n.inArr(e.name,h)?w[e.name]=e.value:p[e.name]=e.value});var v={},g=!1;if("POST"==t||"PUT"==t)if(0==e.state.bodyInfo.type){var b=document.getElementById("bodyTable").querySelectorAll("[custom]");e.getters.bodySave.forEach(function(e,t){if(0==e.type)if(e.encrypt&&e.encrypt.type){var a=o.encrypt(e.encrypt.type,e.selValue,e.encrypt.salt),r=e.name;e.encrypt.key&&(r=o.encrypt(e.encrypt.type,r,e.encrypt.salt)),v[r]=a}else v[e.name]=e.selValue;else if(1==e.type)if(b[t].files.length>0){if(e.encrypt&&e.encrypt.type&&e.encrypt.key){var r=o.encrypt(e.encrypt.type,e.name,e.encrypt.salt);v[r]=b[t].files[0]}else v[e.name]=b[t].files[0];g=!0}else if(e.encrypt&&e.encrypt.type&&e.encrypt.key){var r=o.encrypt(e.encrypt.type,e.name,e.encrypt.salt);v[r]=""}else v[e.name]=""})}else if(0==e.state.bodyInfo.rawType){var S=e.state.encryptType;v=S?o.encrypt(S,e.state.bodyInfo.rawText,document.getElementById("bodyRawEncryptSalt").querySelector("input").value):e.state.bodyInfo.rawText}else{if(!e.state.fileResult)return new Promise(function(e,t){var a={};a.code=0,a.msg="上传内容不能为空！",e(a)});v=e.state.fileResult}p.__url=a,p.__path=r,p.__method=t,p.__user=s.get("id"),p.__headers=JSON.stringify(w);var R="/proxy",P=!1;(/10\./i.test(a)||/192\.168\./i.test(a)||/127\.0\.0\.1/i.test(a)||/172\.(16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)\./.test(a)||/localhost/i.test(a)&&!f)&&(P=!0,R="http://127.0.0.1:36742");var k,q=new Date,I=!1;for(var x in p)if("content-type"==x.toLowerCase()){I=!0,k=x,/multipart\/form-data/i.test(p[k])&&(g=!0);break}return e.state.resultData="",g||1==e.state.bodyInfo.type?(I&&0==e.state.bodyInfo.type&&delete p[k],i.upload("POST",R,v,p,null,1,P).then(function(t){return e.state.resHeader=t.header,e.state.status=String(t.status),e.state.second=((new Date-q)/1e3).toFixed(3),e.state.type=typeof t.data,"object"!=e.state.type||t.data instanceof Blob?t.header["content-type"]&&t.header["content-type"].indexOf("image/")>-1?(e.state.type="img",e.state.rawData="",e.state.imgUrl=a+r):(e.state.rawData=t.data,e.state.draw=t.data,e.state.drawMix=t.data):(e.state.type="object",e.state.resultData=t.data,e.state.rawData=JSON.stringify(t.data),e.state.draw=o.format(e.state.rawData,0,e.state.interface.outParam),e.state.drawMix=o.format(e.state.rawData,1,e.state.interface.outParam)),{code:200}})):i.post(R,v,p,null,1,P).then(function(t){return e.state.resHeader=t.header,e.state.status=String(t.status),e.state.second=((new Date-q)/1e3).toFixed(3),e.state.type=typeof t.data,"object"!=e.state.type||t.data instanceof Blob?t.header["content-type"]&&t.header["content-type"].indexOf("image/")>-1||t.data instanceof Blob?(e.state.type="img",e.state.rawData="",e.state.imgUrl=a+r):(e.state.rawData=t.data,e.state.draw=t.data,e.state.drawMix=t.data):(e.state.resultData=t.data,e.state.rawData=JSON.stringify(t.data),e.state.draw=o.format(e.state.rawData,0,e.state.interface.outParam),e.state.drawMix=o.format(e.state.rawData,1,e.state.interface.outParam)),{code:200}})},save:function(e){var t=e.state.interface.method,a=n.trim(e.state.baseUrl),r=n.trim(e.state.interface.url);if(!t||!a||!r)return new Promise(function(e,t){var a={};a.code=0,a.msg="方法，url和路由地址不能为空!",e(a)});var u=[];e.state.param.forEach(function(e){if(e.name){var t=e.value;if(e.selValue)if(t){var a=e.selValue;t.indexOf(a)==-1&&t.push(a)}else t=[e.selValue];else t||(t=[]);u.push({name:e.name,remark:e.remark,value:t})}});var f=[];e.getters.querySave.forEach(function(e){var t=e.value;if(e.selValue)if(t){var a=e.selValue;t.indexOf(a)==-1&&t.push(a)}else t=[e.selValue];else t||(t=[]);f.push({name:e.name,must:e.must,remark:e.remark,value:t})});var c=[];e.getters.headerSave.forEach(function(e){c.push({name:e.name,value:e.value,remark:e.remark})});var l=[],d=!1;if(("POST"==t||"PUT"==t)&&0==e.state.bodyInfo.type){e.getters.bodySave.forEach(function(e){if(0==e.type){var t=e.value;if(e.selValue)if(t){var a=e.selValue;t.indexOf(a)==-1&&t.push(a)}else t=[e.selValue];else t||(t=[]);l.push({name:e.name,type:0,must:e.must,remark:e.remark,value:t})}else 1==e.type&&(l.push({name:e.name,type:1,must:e.must,remark:e.remark}),d=!0)});var y;for(var m in c)if("content-type"==m.toLowerCase()){y=m;break}d&&(c[y?y:"content-type"]="multipart/form-data")}var p=[];if(e.state.resultData)for(var m in e.state.resultData){var h=o.findObj(e.state.interface.outParam,m);o.handleResultData(m,e.state.resultData[m],p,h)}var w;w="object"==e.state.type?{type:0,rawRemark:"",rawMock:""}:{type:1,rawRemark:e.state.interface.outInfo?e.state.interface.outInfo.rawRemark:"",rawMock:e.state.interface.outInfo?e.state.interface.outInfo.rawMock:""};var v={_id:e.state.interface._id?e.state.interface._id:null,method:t,url:r,queryParam:f,header:c,bodyParam:l,outParam:p,restParam:u,group:{_id:e.state.hash?e.state.hash:e.state.interface.group._id},name:e.state.hash?"":e.state.interface.name,remark:e.state.hash?"":e.state.interface.remark,owner:e.state.hash?"":e.state.interface.owner,editor:e.state.hash?"":e.state.interface.editor,createdAt:e.state.hash?"":e.state.interface.createdAt,updatedAt:e.state.hash?"":e.state.interface.updatedAt,finish:e.state.interface.finish,outInfo:w};"POST"!=t&&"PUT"!=t||(v.bodyInfo=e.state.bodyInfo),s.set("newInterface",JSON.stringify(v));var g=!1;if("MockServer"!=a)for(var b=0;b<e.state.interface.baseUrl.length;b++){var S=new RegExp(e.state.interface.baseUrl[b],"i");if(S.test(a)){g=!0;break}}else g=!0;g?location.href="../projectinfo/projectinfo.html":n.confirm("检测到当前根Url不在BaseUrl之内，是否自动添加",function(){n.startHud(),i.put("/project/addurl",{id:s.get("projectId"),url:a}).then(function(e){n.stopHud(),200==e.code?(n.notify("添加baseUrl成功",1),setTimeout(function(){location.href="../projectinfo/projectinfo.html"},1200)):location.href="../projectinfo/projectinfo.html"})},function(){location.href="../projectinfo/projectinfo.html"})},init:function(e){var t=location.hash.substr(1);return t?(e.state.hash=t,i.get("/project/info",{id:s.get("projectId")}).then(function(t){return 200==t.code&&e.commit("initData",{url:"",baseUrl:t.data.baseUrls,queryParam:[],restParam:[],bodyParam:[],header:[],outParam:[],param:[],method:"GET",bodyInfo:{type:0,rawType:0,rawTextRemark:"",rawFileRemark:"",rawText:""},finish:0}),t})):i.get("/interface/item",{id:s.get("interfaceId"),group:s.get("groupId"),run:1}).then(function(t){return 200==t.code?e.commit("initData",t.data):setTimeout(function(){location.href="../projectinfo/projectinfo.html"},1200),t})}}})}).call(t,a(14),a(0),a(2),a(9),a(3),a(4))}},[122]);